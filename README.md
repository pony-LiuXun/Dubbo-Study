**互联网服务端演变路程**
    
    一、单一应用架构
        当网站流量很小时,为了节约成本,把所有的功能集中部署在一台节点上，这时的关键点在于ORM框架(hibernate,mybaties,spring-data-jpa....).
    
    二、垂直应用架构
        当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC,strust...spring-mvc....)是关键。
        
    三、分布式架构
        当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。
        此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。    
    
    四、流动计算架构
        当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。
        此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。
**dubbo判断服务容量的机制**
    
    一、要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。
        其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，
        记录此时的访问量，再以此访问量乘以机器数反推总容量


**dubbo架构示意图**
    
    具体链接:http://dubbo.apache.org/zh-cn/docs/user/preface/architecture.html
    
    dubbo一次完整的服务调用过程
        1、(provider)服务提供方在服务容器启动。
        2、provider启动后注册到注册中心（register）。
        3、(consumer)服务消费方启动后，到register订阅所需的服务，返回提供方的地址列表。
        4、consumer从地址列表中选取一台机器进行调用，如果调用失败则可以选取其他的机器进行调用。
        5、consumer通过长连接的方式调用provider.
        6、consumer,provider每次调用与被调用都会计数上传至服务监控中心(continer)。
    
    dubbo的几个重要特点:
        一、连通性:
            一、注册中心只负责服务的注册与查找，担当一个目录的角色。不提供请求分发。
            二、监控中心(continer) 负责统计服务被调用的次数，时间，统计的结果现在内存中汇总，之后每一分钟上传至监控服务器中心，以报表的形式展示
            三、服务提供者向注册中心注册其提供的服务。并汇报调用时间到监控中心，此时间不包括网络开销的时间。
            四、服务消费者从注册中心处获取到服务提供的地址列表，根据负载算法（底层实现为权重算法）调用提供者，同时向监控中心报告调用时间，此时间包含网络开销时间。
            五、register,consumer,provider 三者的通信方式均为长连接的方式，continer除外。
            六、注册中心通过长连接感知提供方是否宕机，如果宕机，注册中心立即推送事件通知告知消费方。
            七、如果监控中心和注册中心全部宕机,不影响消费者和提供者的正常使用，因为消费者在本地缓存提供方的地址列表
            八、注册中心和监控中心都是可选并不是必须的，消费方可以直连提供方。
        
        二、健壮性
            一、监控中心宕机，并不影响使用，只是会丢失部分的采样数据
            二、数据库宕机后，注册中心仍能通过缓存提供服务地址查询，但是不能注册新的服务。
            三、在集群的环境下，任意一台机器宕机后，将自动切换到另一台机器，
            四、注册中心宕机后，消费者仍然能通过缓存在本地的服务提供者的地址列表，正确调用服务提供者。
            五、提供者宕机后，消费者将无限制的重连等待提供者恢复。
        
        三、伸缩性
            一、注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心
            二、服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者
**dubbo的配置方式以及配置的加载流程**
**dubbo配置检测**
    一、启动时检查(消费放心跳检测)如果提供方未提供服务，报错 check ="默认为true"
        方式一：<dubbo:service interface="" ref="" check="true"/> 检测单个订阅的服务,
        方式二：<dubbo:consumer check="true"/> 检测消费方所有订阅的服务
        方式三：<dubbo:registry check="false" />关闭注册中心启动时检查 (注册订阅失败时报错)：
    二、容错机制(集群容错)
        消费方容错机制:<dubbo:reference retries="2"/> 重试两次（订阅单个服务）
        提供方容错机制:<dubbo:service retries="2" /> 重试两次同（订阅单个服务）
        提供方将所有服务统一成一个假集群统一管理容错:<dubbo:provider cluster="xxx" />
           几种统一容错机制:
                
                Failfast Cluster
                快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。
                
                Failsafe Cluster
                失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。
                
                Failback Cluster
                失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。
                
                Forking Cluster
                并行调用多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，但需要浪费更多服务资源。可通过 forks="2" 来设置最大并行数。
                
                Broadcast Cluster
                广播调用所有提供者，逐个调用，任意一台报错则报错 [2]。通常用于通知所有提供者更新缓存或日志等本地资源信息。
            
            